<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Swiper demo</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"
    />
    <!-- Link Swiper's CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link rel="stylesheet" href="../css/index.css" />
  </head>

  <body>
    <!-- Overlay that will slide up to reveal content -->
    <!-- <div class="overlay"></div> -->
    <!-- Swiper -->
    <div class="swiper mySwiper">
      <div class="swiper-wrapper">
        <!-- Crawfish Link -->
        <div class="swiper-slide first-slide" data-hash="first-slide">
          <div class="link-main-page-container">
            <div class="image-container-for-portraits-desktop-link">
              <img src="../assets/crawfish-etouffee.jpg" class="link-img" />
            </div>
            <div class="link-container">
              <p class="link-title">Drago's Charbroiled Oyster Recipe</p>
              <p class="link-description">
                This authentic recipe for charbroiled oysters was developed by
                Tommy Cicero of Drago's Restaurant in New Orleans and Metarie,
                Louisiana.
              </p>
              <p class="link-clickable-text-wrapper">
                <a
                  href="https://www.saveur.com"
                  rel="noopener noreferrer"
                  class="link-clickable-text"
                  >SAVEUR.COM</a
                >
              </p>
              <a
                href="https://www.saveur.com"
                class="grey_button"
                rel="noopener noreferrer"
              >
                <img
                  src="../assets/jump_link_white.png"
                  alt="icon"
                  class="button-icon"
                />
                <span>Open Link</span>
              </a>
            </div>
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn">
              <span class="x-line"></span>
            </a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Crawfish Etouffee</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">38/47</span>
            </div>
          </div>
        </div>
        <!-- Little Guy (portrait) -->
        <div class="swiper-slide" data-hash="second-slide">
          <div class="image-container-for-portraits-desktop">
            <img src="../assets/leo-portrait.jpg" class="portrait-img" />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Little Guy</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">39/47</span>
            </div>
          </div>
        </div>
        <!-- Christmas Meal slide (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img src="../assets/christmas-meal.jpg" class="portrait-img" />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Christmas Dinner Table Setting...</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">40/47</span>
            </div>
          </div>
        </div>
        <!-- Italian Roots (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img src="../assets/leo-portrait2.jpg" class="portrait-img" />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Italian Roots</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">41/47</span>
            </div>
          </div>
        </div>
        <!-- Pork with Rosemary with Pencil Icon and Add a Caption feature (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img src="../assets/meat-portrait.jpg" class="portrait-img" />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row">
              <div class="pencil-container">
                <img src="../assets/pencil-white.png" class="pencil" alt="" />
              </div>
              <p class="media-item-title add-new-caption">Add a Caption</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">42/47</span>
            </div>
          </div>
        </div>
        <!-- Christmas Meal slide (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img src="../assets/christmas-meal.jpg" class="portrait-img" />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <!-- <img src="../assets/pencil-white.png" class="pencil" alt="" /> -->
              <p class="media-item-title">Christmas Dinner Table Setting...</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">43/47</span>
            </div>
          </div>
        </div>
        <!-- Leo sideways (landscape) -->
        <div class="swiper-slide">
          <img src="../assets/leo-landscape.jpg" class="landscape-img" />
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Leo Williams</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">44/47</span>
            </div>
          </div>
        </div>
        <!-- Youtube Video in Africa in playing mode for mobile (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img
              src="../assets/youtube-kenya-iphone-playing.png"
              class="portrait-img youtube-portrait"
            />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Finding the Wildebeasts on Safari</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">45/47</span>
            </div>
          </div>
        </div>
        <!-- Youtube Video in Africa not in play mode for mobile (landscape) -->
        <div class="swiper-slide">
          <div class="kenya-video-iphone-image-container">
            <img
              src="../assets/youtube-kenya-iphone-not-playing.jpg"
              class="landscape-img youtube-landscape"
            />
            <img
              src="../assets/video_play.png"
              alt="icon"
              class="centered-video_play-icon"
            />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Finding the Wildebeasts on Safari</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">46/47</span>
            </div>
          </div>
        </div>
        <!-- Pasta with Truffle (landscape) -->
        <div class="swiper-slide">
          <img src="../assets/pasta.jpg" class="landscape-img" />
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">A great pasta dish with truffle</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <div class="number-of-items-btn">
              <span class="number-of-items-text">47/47</span>
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="swiper-pagination"></div> -->
    </div>
    <!-- Custom Up and Down Buttons -->
    <div class="navigation-buttons">
      <!-- <button class="up-arrow-btn"></button> -->
      <button class="down-arrow-btn"></button>
      <!-- Options POPUP-->
      <div id="options-links" class="popup-container">
        <button id="options-close-btn" class="dropdown-close-btn">×</button>
        <!-- <div class="dropdown-title">Options</div> -->
        <!-- Menu List -->
        <ul>
          <li>Edit Caption</li>
          <li>Change Header</li>
          <li>Set as Album Cover</li>
          <li>Send to a Connection</li>
          <li>Copy to an Album</li>
          <li>Delete</li>
        </ul>
      </div>
      <!-- Edit Caption Pop-up -->
      <div id="edit-caption-popup" class="edit-caption-popup hidden">
        <textarea id="edit-caption-textarea" maxlength="100"></textarea>
        <button id="save-caption-btn">Save</button>
      </div>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Initialize Swiper and Button Functionality -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let isTouchActive = false;
        let isTitleRowVisible = true;
        let hasSwipedOnTouch = false;

        // Initialize Swiper (vertical direction)
        const swiper = new Swiper(".mySwiper", {
          direction: "vertical",
          speed: 200,
          on: {
            slideChange: function () {
              updateArrowStyles();
            },
            reachBeginning: updateArrowStyles,
            reachEnd: updateArrowStyles,
            slideChangeTransitionStart: function () {
              handleSlideChange();
              // Close the dropdown if it is open
              if (dropdownMenu.classList.contains("open")) {
                closeDropdownMenu();
              }
            },
          },
        });

        function closeDropdownMenu() {
          dropdownMenu.classList.remove("open");
          dropdownMenu.style.display = "none";
          activeOptionsBtn = null;
        }

        const downButton = document.querySelector(".down-arrow-btn");

        // Elements for Edit Caption functionality
        const editCaptionPopup = document.getElementById("edit-caption-popup");
        const editCaptionTextarea = document.getElementById(
          "edit-caption-textarea"
        );
        const saveCaptionBtn = document.getElementById("save-caption-btn");

        // Function to handle slide change if popup is open
        function handleSlideChange() {
          if (!editCaptionPopup.classList.contains("hidden")) {
            saveCaptionBtn.click(); // Save the current caption
          }
        }

        // Function to handle arrow click with opacity effect and popup check
        function handleArrowClick(button) {
          if (!button.classList.contains("disabled")) {
            if (!editCaptionPopup.classList.contains("hidden")) {
              saveCaptionBtn.click();
            }

            button.classList.add("active-opacity");
            setTimeout(() => {
              button.classList.remove("active-opacity");
            }, 200);

            if (!swiper.isEnd) {
              swiper.slideNext();
            }
          }
        }

        downButton.addEventListener("click", () =>
          handleArrowClick(downButton)
        );

        // Function to update arrow styles (for disabling)
        function updateArrowStyles() {
          if (swiper.isEnd) {
            downButton.classList.add("disabled");
            downButton.style.opacity = "0.2";
            downButton.setAttribute("disabled", true);
          } else {
            downButton.classList.remove("disabled");
            downButton.style.opacity = "1";
            downButton.removeAttribute("disabled");
          }
        }

        // Initial update to arrow styles
        updateArrowStyles();

        // Function to toggle the title-row visibility
        function toggleTitleRow() {
          const titleRows = document.querySelectorAll(".title-row");
          const titleRowBottoms =
            document.querySelectorAll(".title-row-bottom");

          if (isTitleRowVisible) {
            titleRows.forEach((titleRow) =>
              titleRow.classList.add("hidden-title-row")
            );
            titleRowBottoms.forEach((titleRowBottom) =>
              titleRowBottom.classList.add("hidden-title-row")
            );
          } else {
            titleRows.forEach((titleRow) =>
              titleRow.classList.remove("hidden-title-row")
            );
            titleRowBottoms.forEach((titleRowBottom) =>
              titleRowBottom.classList.remove("hidden-title-row")
            );
          }

          isTitleRowVisible = !isTitleRowVisible;
        }

        // Attach click event listener to toggle title-row
        const swiperContainer = document.querySelector(".swiper");
        swiperContainer.addEventListener("click", function (event) {
          if (!event.target.closest(".down-arrow-btn")) {
            if (dropdownMenu.classList.contains("open")) {
              closeDropdownMenu();
            } else {
              toggleTitleRow();
            }
          }
        });

        // Dropdown functionality
        const optionsBtns = document.querySelectorAll(".options-btn");
        const dropdownMenu = document.getElementById("options-links");
        const closeBtn = document.getElementById("options-close-btn");

        let activeOptionsBtn = null;

        function positionDropdownMenu() {
          if (!activeOptionsBtn) return;

          dropdownMenu.style.display = "block";
          dropdownMenu.style.visibility = "hidden";

          dropdownMenu.offsetHeight;

          const rect = activeOptionsBtn.getBoundingClientRect();
          const dropdownWidth = dropdownMenu.offsetWidth;

          dropdownMenu.style.position = "fixed";
          dropdownMenu.style.top = rect.top + "px";
          dropdownMenu.style.left = rect.right - dropdownWidth + "px";
          dropdownMenu.style.visibility = "visible";
        }

        optionsBtns.forEach(function (optionsBtn) {
          optionsBtn.addEventListener("click", function (event) {
            event.stopPropagation();
            const isOpen = dropdownMenu.classList.contains("open");

            if (isOpen) {
              closeDropdownMenu();
            } else {
              activeOptionsBtn = optionsBtn;
              dropdownMenu.classList.add("open");
              positionDropdownMenu();
            }
          });
        });

        closeBtn.addEventListener("click", function (event) {
          event.stopPropagation();
          closeDropdownMenu();
        });

        dropdownMenu.addEventListener("click", function (event) {
          event.stopPropagation();
        });

        window.addEventListener("resize", function () {
          if (dropdownMenu.classList.contains("open")) {
            positionDropdownMenu();
          }
        });

        // Function to open the edit caption popup
        function openEditCaptionPopup() {
          const currentSlide = swiper.slides[swiper.activeIndex];
          const titleElement = currentSlide.querySelector(".media-item-title");

          let captionText = "";
          if (
            titleElement &&
            !titleElement.classList.contains("add-new-caption")
          ) {
            captionText = titleElement.textContent.trim();
          }

          editCaptionTextarea.placeholder = "Photo Caption";
          editCaptionTextarea.value = captionText;

          editCaptionPopup.classList.remove("hidden");
          editCaptionTextarea.scrollTop = 0;
          editCaptionTextarea.focus();

          const titleRow = currentSlide.querySelector(".title-row");
          if (titleRow) {
            titleRow.classList.add("hidden-title-row");
          }
        }

        function closeEditCaptionPopup() {
          editCaptionPopup.classList.add("hidden");
          editCaptionTextarea.focus();

          const currentSlide = swiper.slides[swiper.activeIndex];
          const titleRow = currentSlide.querySelector(".title-row");
          if (titleRow) {
            titleRow.classList.remove("hidden-title-row");
          }
        }

        // Event listener for the "Edit Caption" option
        const editCaptionOption = dropdownMenu.querySelector("li:nth-child(1)");
        editCaptionOption.addEventListener("click", function (event) {
          event.stopPropagation();
          closeDropdownMenu();
          openEditCaptionPopup();
        });

        saveCaptionBtn.addEventListener("click", function () {
          const newCaption = editCaptionTextarea.value.trim();
          const currentSlide = swiper.slides[swiper.activeIndex];
          const pencilTitleRow =
            currentSlide.querySelector(".pencil-title-row");

          const existingTitleElements =
            pencilTitleRow.querySelectorAll(".media-item-title");
          existingTitleElements.forEach((element) => element.remove());

          const existingPencilContainers =
            pencilTitleRow.querySelectorAll(".pencil-container");
          existingPencilContainers.forEach((element) => element.remove());

          if (newCaption === "") {
            const pencilContainer = document.createElement("div");
            pencilContainer.classList.add("pencil-container");

            const pencilImg = document.createElement("img");
            pencilImg.src = "../assets/pencil-white.png";
            pencilImg.classList.add("pencil");
            pencilImg.alt = "";

            pencilContainer.appendChild(pencilImg);
            pencilContainer.addEventListener("click", function (event) {
              event.stopPropagation();
              openEditCaptionPopup();
            });

            const addCaptionElement = document.createElement("p");
            addCaptionElement.classList.add(
              "media-item-title",
              "add-new-caption"
            );
            addCaptionElement.textContent = "Add a Caption";

            addCaptionElement.addEventListener("click", function (event) {
              event.stopPropagation();
              openEditCaptionPopup();
            });

            pencilTitleRow.appendChild(pencilContainer);
            pencilTitleRow.appendChild(addCaptionElement);
            pencilTitleRow.classList.remove("non-interactive");
          } else {
            const titleElement = document.createElement("p");
            titleElement.classList.add("media-item-title");
            titleElement.textContent = newCaption;
            pencilTitleRow.appendChild(titleElement);
            pencilTitleRow.classList.add("non-interactive");
          }

          closeEditCaptionPopup();
        });

        // Close the edit caption popup when clicking outside of it
        document.addEventListener("click", function (event) {
          if (
            !editCaptionPopup.contains(event.target) &&
            !event.target.classList.contains("options-btn") &&
            !event.target.closest(".pencil-container") &&
            !event.target.classList.contains("add-new-caption")
          ) {
            if (!editCaptionPopup.classList.contains("hidden")) {
              saveCaptionBtn.click();
            }
          }
        });

        // Prevent event propagation when clicking inside the edit caption popup
        editCaptionPopup.addEventListener("click", function (event) {
          event.stopPropagation();
        });

        // Function to update the arrow styles (for disabling)
        function updateArrowStyles() {
          if (swiper.isBeginning) {
            downButton.classList.add("disabled");
            downButton.style.opacity = "0.2"; // Lower opacity when disabled
            downButton.setAttribute("disabled", true);
          } else {
            downButton.classList.remove("disabled");
            downButton.style.opacity = "1"; // Full opacity when enabled
            downButton.removeAttribute("disabled");
          }

          if (swiper.isEnd) {
            downButton.classList.add("disabled");
            downButton.style.opacity = "0.2"; // Lower opacity when disabled
            downButton.setAttribute("disabled", true);
          } else {
            downButton.classList.remove("disabled");
            downButton.style.opacity = "1"; // Full opacity when enabled
            downButton.removeAttribute("disabled");
          }
        }

        // Ensure the arrow styles are updated when necessary
        updateArrowStyles();
      });
    </script>
  </body>
</html>
