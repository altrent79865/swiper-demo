<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Responsive Swiper Demo</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"
    />
    <!-- Link Swiper's CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="../css/index-combined-navigation-autoplay.css"
    />
  </head>

  <body>
    <!-- Swiper -->
    <div class="swiper mySwiper">
      <div class="swiper-wrapper">
        <!-- Crawfish Link -->
        <div class="swiper-slide first-slide" data-hash="first-slide">
          <div class="link-main-page-container">
            <div class="image-container-for-portraits-desktop-link">
              <img src="../assets/crawfish-etouffee.jpg" class="link-img" />
            </div>
            <div class="link-container">
              <p class="link-title">Drago's Charbroiled Oyster Recipe</p>
              <p class="link-description">
                This authentic recipe for charbroiled oysters was developed by
                Tommy Cicero of Drago's Restaurant in New Orleans.
              </p>
              <p class="link-clickable-text-wrapper">
                <a
                  href="https://www.saveur.com"
                  rel="noopener noreferrer"
                  class="link-clickable-text"
                  >SAVEUR.COM</a
                >
              </p>
              <a
                href="https://www.saveur.com"
                class="link-button"
                rel="noopener noreferrer"
              >
                <img
                  src="../assets/jump_link_white.png"
                  alt="icon"
                  class="button-icon"
                />
                <span>Open Link</span>
              </a>
            </div>
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn">
              <span class="x-line"></span>
            </a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Crawfish Etouffee</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn" aria-label="Options">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button
              class="autoplay-toggle green-play"
              aria-label="Play Autoplay"
            >
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">38/47</span>
            </div>
          </div>
        </div>
        <!-- Sandwich slide (portrait) -->
        <div class="swiper-slide" data-hash="second-slide">
          <div class="image-container-for-portraits-desktop">
            <img
              src="../assets/sandwich-profile-3024x4032.jpeg"
              class="portrait-img"
            />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Focaccia with Mortadella</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">39/47</span>
            </div>
          </div>
        </div>
        <!-- Christmas Meal slide (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img src="../assets/christmas-meal.jpg" class="portrait-img" />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Christmas Dinner Table and Dessert</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">40/47</span>
            </div>
          </div>
        </div>
        <!-- Salsa (portrait) -->
        <div class="swiper-slide">
          <img src="../assets/salsa3024x4032.jpeg" class="portrait-img" />
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Favorite Salsas</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">41/47</span>
            </div>
          </div>
        </div>
        <!-- Pork with Rosemary with Pencil Icon and Add a Caption feature (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img src="../assets/meat-portrait.jpg" class="portrait-img" />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row">
              <div class="pencil-container">
                <img src="../assets/pencil-white.png" class="pencil" alt="" />
              </div>
              <p class="media-item-title add-new-caption">Add a Caption</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">42/47</span>
            </div>
          </div>
        </div>
        <!-- Fruit Plate slide (portrait) -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <img
              src="../assets/fruit-portrait-3024x4032.jpeg"
              class="portrait-img"
            />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <!-- <img src="../assets/pencil-white.png" class="pencil" alt="" /> -->
              <p class="media-item-title">Fruit Plate with Pineapple & Melon</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">43/47</span>
            </div>
          </div>
        </div>
        <!-- Sandwich slide (landscape) -->
        <div class="swiper-slide">
          <img
            src="../assets/sandwich-unmade-landscape-4032x3024.jpeg"
            class="landscape-img"
          />
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Focaccia with Mortadella</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">44/47</span>
            </div>
          </div>
        </div>
        <!-- Youtube Video in Africa not in play mode -->
        <div class="swiper-slide">
          <div class="kenya-video-iphone-image-container">
            <img
              src="../assets/youtube-kenya-iphone-not-playing.jpg"
              class="landscape-img youtube-landscape"
            />
            <img
              src="../assets/video_play.png"
              alt="icon"
              class="centered-video_play-icon"
            />
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Finding the Wildebeasts on Safari</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">45/47</span>
            </div>
          </div>
        </div>
        <!-- Youtube Video in Africa in playing mode -->
        <div class="swiper-slide">
          <div class="image-container-for-portraits-desktop">
            <picture>
              <!-- Image for screens 601px and larger -->
              <source
                srcset="../assets/youtube-kenya-desktop-playing.png"
                media="(min-width: 601px)"
              />
              <!-- Default image for screens up to 600px width -->
              <img
                src="../assets/youtube-kenya-iphone-playing.png"
                class="portrait-img youtube-portrait"
                alt="Youtube video of safari in Kenya"
              />
            </picture>
          </div>
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Finding the Wildebeasts on Safari</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">46/47</span>
            </div>
          </div>
        </div>
        <!-- Grilled Focaccia Sandwich (landscape) -->
        <div class="swiper-slide">
          <img
            src="../assets/sandwich-landscape-4032x3024.jpeg"
            class="landscape-img"
          />
          <div class="title-row">
            <a href="../index.html" class="close-btn"
              ><span class="x-line"></span
            ></a>
            <div class="pencil-title-row non-interactive">
              <p class="media-item-title">Grilled Focaccia with Mortadella</p>
            </div>
            <!-- Options Button -->
            <button class="options-btn">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </button>
          </div>
          <div class="title-row-bottom">
            <button class="autoplay-toggle" aria-label="Play Autoplay">
              <svg
                class="icon play-icon"
                width="13"
                height="15"
                viewBox="0 0 13 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <polygon points="0.5,0 12.0,7.5 0.5,15" fill="white" />
              </svg>
              <svg
                class="icon pause-icon"
                width="14"
                height="15"
                viewBox="0 0 14 15"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect x="0.25" y="1.5" width="3" height="12" fill="white" />
                <rect x="8.25" y="1.5" width="3" height="12" fill="white" />
              </svg>
            </button>
            <div class="number-of-items-btn">
              <span class="number-of-items-text">47/47</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Navigation Buttons for Vertical Swiper (Up & Down) -->
    <div class="navigation-buttons">
      <button class="up-arrow-btn" aria-label="Navigate Up"></button>
      <button class="down-arrow-btn" aria-label="Navigate Down"></button>
    </div>
    <!-- Navigation Buttons for Horizontal Swiper (Left & Right) -->
    <button class="left-arrow-btn" aria-label="Navigate Left"></button>
    <button class="right-arrow-btn" aria-label="Navigate Right"></button>

    <!-- Options Dropdown -->
    <div
      id="options-links"
      class="options-dropdown swiper-vertical-options-dropdown"
    >
      <button id="options-close-btn" class="dropdown-close-btn">×</button>
      <!-- List of Links in the dropdown from Options button -->
      <ul>
        <li>Edit Caption</li>
        <li>Change Header</li>
        <li>Set as Album Cover</li>
        <li>Send to a Connection</li>
        <li>Copy to an Album</li>
        <li>Delete</li>
      </ul>
    </div>

    <!-- Edit Caption Pop-up -->
    <div id="edit-caption-popup" class="edit-caption-popup hidden">
      <textarea id="edit-caption-textarea" maxlength="100"></textarea>
      <button id="save-caption-btn">Save</button>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Initialize Swiper and Handle Navigation -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Select all Play/Pause buttons
        const autoplayButtons = document.querySelectorAll(".autoplay-toggle");

        // Declare a flag to track the first autoplay slide
        let firstAutoplaySlide = false;

        // Initialize Swiper with Autoplay Disabled by Default
        const swiper = new Swiper(".mySwiper", {
          direction: "vertical", // Swiper Vertical - direction for phones
          loop: false,
          speed: 200, // Speed for vertical navigation
          autoplay: false,
          breakpoints: {
            601: {
              // When window width is >= 601px
              direction: "horizontal", // Switch to Swiper Navigation
              speed: 300, // Speed for horizontal navigation
            },
          },
          on: {
            slideChange: function () {
              updateArrowStyles();

              // Adjust autoplay delay after the first slide transition
              if (swiper.autoplay.running && firstAutoplaySlide) {
                swiper.params.autoplay.delay = 3000;
                firstAutoplaySlide = false;
                swiper.autoplay.stop();
                swiper.autoplay.start();
              }

              // Close the dropdown if it is open
              if (dropdownMenu.classList.contains("open")) {
                closeDropdownMenu();
              }
            },
            reachBeginning: updateArrowStyles,
            reachEnd: updateArrowStyles,
            slideChangeTransitionStart: function () {
              handleSlideChange();
            },
          },
        });

        // Function to update the autoplay button states
        function updateAutoplayButtonState() {
          autoplayButtons.forEach((button) => {
            if (swiper.autoplay.running) {
              button.classList.add("playing");
              button.setAttribute("aria-label", "Pause Autoplay");
            } else {
              button.classList.remove("playing");
              button.setAttribute("aria-label", "Play Autoplay");
            }
          });
        }

        // Initialize Play/Pause buttons to show Play state
        updateAutoplayButtonState();

        // Function to toggle autoplay and update button appearance
        function toggleAutoplay() {
          if (swiper.autoplay.running) {
            swiper.autoplay.stop();
          } else {
            swiper.params.autoplay.delay = 500;
            swiper.params.autoplay.disableOnInteraction = false;
            swiper.params.autoplay.pauseOnMouseEnter = false;
            swiper.params.autoplay.stopOnLastSlide = true;
            firstAutoplaySlide = true;
            swiper.autoplay.start();
          }
          updateAutoplayButtonState();
        }

        // Attach event listeners to all Play/Pause buttons
        autoplayButtons.forEach(function (button) {
          button.addEventListener("click", function (e) {
            e.stopPropagation(); // Prevent triggering other click events
            toggleAutoplay();
          });
        });

        // Function to stop autoplay and update buttons
        function stopAutoplayAndUpdateButtons() {
          if (swiper.autoplay.running) {
            swiper.autoplay.stop();
            updateAutoplayButtonState();
          }
        }

        // Navigation Buttons
        const upButton = document.querySelector(".up-arrow-btn"); // Up arrow is hidden
        const downButton = document.querySelector(".down-arrow-btn");
        const leftArrow = document.querySelector(".left-arrow-btn");
        const rightArrow = document.querySelector(".right-arrow-btn");

        // Elements for Edit Caption functionality
        const editCaptionPopup = document.getElementById("edit-caption-popup");
        const editCaptionTextarea = document.getElementById(
          "edit-caption-textarea"
        );
        const saveCaptionBtn = document.getElementById("save-caption-btn");

        // Options Dropdown Menu
        const dropdownMenu = document.getElementById("options-links");
        const closeBtn = document.getElementById("options-close-btn");
        let activeOptionsBtn = null;

        // Declare currentEditingSlide to keep track of the slide being edited
        let currentEditingSlide = null; // Keeps track of the slide being edited

        // Function to update arrow styles (for disabling)
        function updateArrowStyles() {
          // Determine current mode based on screen width
          const isVertical = window.innerWidth <= 600;

          if (isVertical) {
            // Update Vertical Navigation
            if (swiper.isEnd) {
              downButton.classList.add("disabled");
              downButton.style.opacity = "0.2";
              downButton.setAttribute("disabled", true);
            } else {
              downButton.classList.remove("disabled");
              downButton.style.opacity = "1";
              downButton.removeAttribute("disabled");
            }

            if (swiper.isBeginning) {
              upButton.classList.add("disabled");
              upButton.style.opacity = "0.2";
              upButton.setAttribute("disabled", true);
            } else {
              upButton.classList.remove("disabled");
              upButton.style.opacity = "1";
              upButton.removeAttribute("disabled");
            }
          } else {
            // Update Horizontal Navigation
            if (swiper.isEnd) {
              rightArrow.classList.add("disabled");
              rightArrow.style.opacity = "0.2";
              rightArrow.setAttribute("disabled", true);
            } else {
              rightArrow.classList.remove("disabled");
              rightArrow.style.opacity = "1";
              rightArrow.removeAttribute("disabled");
            }

            if (swiper.isBeginning) {
              leftArrow.classList.add("disabled");
              leftArrow.style.opacity = "0.2";
              leftArrow.setAttribute("disabled", true);
            } else {
              leftArrow.classList.remove("disabled");
              leftArrow.style.opacity = "1";
              leftArrow.removeAttribute("disabled");
            }
          }
        }

        // Initial update to arrow styles
        updateArrowStyles();

        // Debounced window resize event
        let resizeTimeout;
        window.addEventListener("resize", function () {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(() => {
            updateArrowStyles();
            if (dropdownMenu.classList.contains("open")) {
              positionDropdownMenu();
            }
          }, 100);
        });

        // Function to handle slide change if popup is open
        function handleSlideChange() {
          if (!editCaptionPopup.classList.contains("hidden")) {
            // Save the caption to the slide being left using swiper.previousIndex
            saveCaptionToSlide();
          }
        }

        // Function to handle arrow click with opacity effect and popup check
        function handleArrowClick(button, direction) {
          if (!button.classList.contains("disabled")) {
            // Check if the popup is open
            if (!editCaptionPopup.classList.contains("hidden")) {
              // Save the current caption
              saveCaptionBtn.click();
            }

            button.classList.add("active-opacity");

            // Remove the class after 100ms for the transition effect
            setTimeout(() => {
              button.classList.remove("active-opacity");
            }, 100);

            // Trigger slide navigation directly
            if (direction === "next") {
              swiper.slideNext();
            } else if (direction === "prev") {
              swiper.slidePrev();
            }
          }
        }

        // Navigation Buttons and their directions
        const navigationButtons = [
          { button: upButton, direction: "prev" },
          { button: downButton, direction: "next" },
          { button: leftArrow, direction: "prev" },
          { button: rightArrow, direction: "next" },
        ];

        // Attach event listeners to navigation buttons
        navigationButtons.forEach(({ button, direction }) => {
          button.addEventListener("touchstart", handleTouchStart);
          button.addEventListener("touchend", (e) =>
            handleTouchEnd(e, direction)
          );
          button.addEventListener("click", (e) => handleClick(e, direction));
        });

        // Prevent double navigation (touch + click)
        let isTouchActive = false;
        let hasSwipedOnTouch = false; // Flag to track swiping during touch event

        function handleTouchStart(e) {
          if (e.target.classList.contains("disabled")) {
            e.preventDefault(); // Prevent default behavior (like zooming)
            e.stopPropagation(); // Prevent event from bubbling up
            return;
          }
          e.preventDefault(); // Always prevent default behavior
          isTouchActive = true;
          hasSwipedOnTouch = false; // Reset the swipe flag at the start of touch
        }

        function handleTouchEnd(e, direction) {
          if (!e.target.classList.contains("disabled") && !hasSwipedOnTouch) {
            handleArrowClick(e.target, direction);
          }
          setTimeout(() => {
            isTouchActive = false;
          }, 100);
        }

        function handleClick(e, direction) {
          if (!isTouchActive && !e.target.classList.contains("disabled")) {
            e.stopPropagation();
            handleArrowClick(e.target, direction);
          }
        }

        // Detect swipe to prevent touchend from triggering slide navigation twice
        swiper.on("slidePrevTransitionStart", () => {
          hasSwipedOnTouch = true;
        });

        swiper.on("slideNextTransitionStart", () => {
          hasSwipedOnTouch = true;
        });

        // Function to toggle the title-row and navigation buttons visibility, along with down arrow-button for slider vertical.
        let isTitleRowVisible = true; // Start with title-row visible

        function toggleTitleRow() {
          const titleRows = document.querySelectorAll(".title-row");
          const titleRowBottoms =
            document.querySelectorAll(".title-row-bottom");
          const downArrowBtn = document.querySelector(".down-arrow-btn");

          if (isTitleRowVisible) {
            // Hide title rows
            titleRows.forEach((titleRow) =>
              titleRow.classList.add("hidden-title-row")
            );
            titleRowBottoms.forEach((titleRowBottom) =>
              titleRowBottom.classList.add("hidden-title-row")
            );
            // Hide down-arrow-btn
            downArrowBtn.classList.add("hidden-title-row");
          } else {
            // Show title rows
            titleRows.forEach((titleRow) =>
              titleRow.classList.remove("hidden-title-row")
            );
            titleRowBottoms.forEach((titleRowBottom) =>
              titleRowBottom.classList.remove("hidden-title-row")
            );
            // Show down-arrow-btn
            downArrowBtn.classList.remove("hidden-title-row");
          }

          isTitleRowVisible = !isTitleRowVisible;
        }

        // Attach click event listener to toggle title-row, excluding the navigation and options buttons
        const swiperContainer = document.querySelector(".swiper");
        swiperContainer.addEventListener("click", function (event) {
          const target = event.target;

          // Check if the clicked element is within the navigation buttons or options buttons
          if (
            !target.closest(".down-arrow-btn") &&
            !target.closest(".up-arrow-btn") &&
            !target.closest(".left-arrow-btn") &&
            !target.closest(".right-arrow-btn") &&
            !target.closest(".options-btn")
          ) {
            if (dropdownMenu.classList.contains("open")) {
              // Close the dropdown menu
              closeDropdownMenu();
            } else if (
              target.closest(".pencil-container") ||
              target.closest(".add-new-caption") ||
              target.closest(".media-item-title:not(.non-interactive)")
            ) {
              // Handle caption edit clicks
              const slide = target.closest(".swiper-slide");
              if (slide) {
                handleCaptionEditClick(event, slide);
              }
            } else {
              toggleTitleRow();
            }
          }
        });

        // Options Dropdown Menu Positioning and Toggle
        function positionDropdownMenu() {
          if (!activeOptionsBtn) return;

          // Temporarily display the dropdown menu to get its dimensions
          dropdownMenu.style.display = "block";
          dropdownMenu.style.visibility = "hidden";

          // Allow the browser to render the dropdown menu
          dropdownMenu.offsetHeight;

          // Get the position of the options button relative to the viewport
          const rect = activeOptionsBtn.getBoundingClientRect();

          // Get the dropdown menu's width
          const dropdownWidth = dropdownMenu.offsetWidth;

          // Position the dropdown menu so that its top right corner aligns with the top right corner of the options button
          dropdownMenu.style.position = "fixed";
          dropdownMenu.style.top = rect.top + "px"; // Align top edges
          dropdownMenu.style.left = rect.right - dropdownWidth + "px"; // Align right edges

          dropdownMenu.style.visibility = "visible";
        }

        document.addEventListener("click", function (event) {
          const optionsButton = event.target.closest(".options-btn");
          if (optionsButton) {
            event.stopPropagation(); // Prevent click from toggling the title row

            // Stop autoplay if running
            stopAutoplayAndUpdateButtons();

            const isOpen = dropdownMenu.classList.contains("open");

            if (isOpen) {
              // Close dropdown menu
              dropdownMenu.classList.remove("open");
              dropdownMenu.style.display = "none";
              activeOptionsBtn = null;
            } else {
              // Set the active options button
              activeOptionsBtn = optionsButton;

              dropdownMenu.classList.add("open");

              // Position the dropdown menu
              positionDropdownMenu();
            }
          }
        });

        // Dropdown Close Button
        closeBtn.addEventListener("click", function (event) {
          event.stopPropagation();
          dropdownMenu.classList.remove("open");
          dropdownMenu.style.display = "none"; // Hide the dropdown menu
          activeOptionsBtn = null;
        });

        // Prevent event propagation when clicking inside the dropdown menu
        dropdownMenu.addEventListener("click", function (event) {
          event.stopPropagation();
        });

        // Function to open the edit caption popup
        function openEditCaptionPopup(slide) {
          currentEditingSlide = slide; // Store the current slide
          const titleElement = slide.querySelector(".media-item-title");

          // Trim any unnecessary spaces and ensure text is clean.
          let captionText = "";
          if (
            titleElement &&
            !titleElement.classList.contains("add-new-caption")
          ) {
            captionText = titleElement.textContent.trim();
          }

          // Set the placeholder text and current title
          editCaptionTextarea.placeholder = "Photo Caption";
          editCaptionTextarea.value = captionText;

          // Show the popup
          editCaptionPopup.classList.remove("hidden");
          editCaptionTextarea.scrollTop = 0;
          editCaptionTextarea.focus();

          // Hide the title row while editing
          const titleRow = slide.querySelector(".title-row");
          if (titleRow) {
            titleRow.classList.add("hidden-title-row");
          }
        }

        // Function to close the edit caption popup
        function closeEditCaptionPopup() {
          // Hide the popup
          editCaptionPopup.classList.add("hidden");
          editCaptionTextarea.blur();

          // Show the title row of the slide being saved
          if (currentEditingSlide) {
            const titleRow = currentEditingSlide.querySelector(".title-row");
            if (titleRow) {
              titleRow.classList.remove("hidden-title-row");
            }
            currentEditingSlide = null; // Reset after closing
          }
        }

        // Function to close dropdown menu
        function closeDropdownMenu() {
          dropdownMenu.classList.remove("open");
          dropdownMenu.style.display = "none";
          activeOptionsBtn = null;
        }

        // Event listener for the "Edit Caption" option
        const editCaptionOption = dropdownMenu.querySelector("li:nth-child(1)");
        editCaptionOption.addEventListener("click", function (event) {
          event.stopPropagation();
          closeDropdownMenu(); // Close the options dropdown
          // Get the current slide
          const currentSlide = swiper.slides[swiper.activeIndex];
          openEditCaptionPopup(currentSlide);
        });

        // Function to save caption to the current editing slide
        function saveCaptionToSlide() {
          if (!currentEditingSlide) return; // Safety check

          // Get the new caption from the textarea with trim to remove unnecessary whitespace
          const newCaption = editCaptionTextarea.value.trim();

          // Get the pencilTitleRow within the current editing slide
          const pencilTitleRow =
            currentEditingSlide.querySelector(".pencil-title-row");
          if (!pencilTitleRow) return; // Safety check

          // Remove all existing title elements
          const existingTitleElements =
            pencilTitleRow.querySelectorAll(".media-item-title");
          existingTitleElements.forEach((element) => element.remove());

          // Remove all existing pencil-container elements
          const existingPencilContainers =
            pencilTitleRow.querySelectorAll(".pencil-container");
          existingPencilContainers.forEach((element) => element.remove());

          // Capture the slide reference before resetting currentEditingSlide
          const slide = currentEditingSlide;

          if (newCaption === "") {
            // When caption is empty, show pencil icon and "Add a Caption"
            const pencilContainer = document.createElement("div");
            pencilContainer.classList.add("pencil-container");

            // Create pencil-container with pencil icon
            const pencilImg = document.createElement("img");
            pencilImg.src = "../assets/pencil-white.png";
            pencilImg.classList.add("pencil");
            pencilImg.alt = "";

            pencilContainer.appendChild(pencilImg);

            // Close the dropdown menu if it's open
            if (dropdownMenu.classList.contains("open")) {
              closeDropdownMenu();
            }

            // Append pencilContainer and addCaptionElement to pencilTitleRow
            const addCaptionElement = document.createElement("p");
            addCaptionElement.classList.add(
              "media-item-title",
              "add-new-caption"
            );
            addCaptionElement.textContent = "Add a Caption";

            pencilTitleRow.appendChild(pencilContainer);
            pencilTitleRow.appendChild(addCaptionElement);

            // Remove "non-interactive" class from pencilTitleRow
            pencilTitleRow.classList.remove("non-interactive");
          } else {
            // When there is a caption, show caption text without pencil icon

            // Create new title element
            const titleElement = document.createElement("p");
            titleElement.classList.add("media-item-title");
            titleElement.textContent = newCaption;

            // Append titleElement to pencilTitleRow
            pencilTitleRow.appendChild(titleElement);

            // Remove "non-interactive" class from pencilTitleRow
            pencilTitleRow.classList.remove("non-interactive");
          }

          // Close the popup and show the correct title row
          closeEditCaptionPopup();
        }

        // Event listener for the "Save" button in the popup
        saveCaptionBtn.addEventListener("click", function () {
          // Save caption to the current editing slide
          saveCaptionToSlide();
        });

        // Function to handle caption edit clicks
        function handleCaptionEditClick(event, slide) {
          event.stopPropagation();
          stopAutoplayAndUpdateButtons();
          if (dropdownMenu.classList.contains("open")) {
            closeDropdownMenu();
          }
          openEditCaptionPopup(slide);
        }

        // Close the edit caption popup when clicking outside of it
        document.addEventListener("click", function (event) {
          if (
            !editCaptionPopup.contains(event.target) &&
            !event.target.closest(".options-btn") &&
            !event.target.closest(".pencil-container") &&
            !event.target.closest(".add-new-caption") &&
            !event.target.closest(".media-item-title")
          ) {
            if (!editCaptionPopup.classList.contains("hidden")) {
              // Simulate clicking the "Save" button to save current caption
              saveCaptionBtn.click();
            }
          }
        });

        // Prevent event propagation when clicking inside the edit caption popup
        editCaptionPopup.addEventListener("click", function (event) {
          event.stopPropagation();
        });

        // Keydown event listener on keyboard
        document.addEventListener("keydown", function (e) {
          // Check if the swiper instance exists
          if (!swiper) return;

          // Determine the current direction of Swiper
          if (swiper.isVertical()) {
            if (e.key === "ArrowUp") {
              e.preventDefault(); // Prevent default scrolling
              swiper.slidePrev();
            } else if (e.key === "ArrowDown") {
              e.preventDefault(); // Prevent default scrolling
              swiper.slideNext();
            }
          } else if (swiper.isHorizontal()) {
            if (e.key === "ArrowLeft") {
              e.preventDefault(); // Prevent default scrolling
              swiper.slidePrev();
            } else if (e.key === "ArrowRight") {
              e.preventDefault(); // Prevent default scrolling
              swiper.slideNext();
            }
          }
        });
      });
    </script>
  </body>
</html>
